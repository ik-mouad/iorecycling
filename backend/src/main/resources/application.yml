spring:
  application:
    name: iorecycling-backend
  
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}
  
  datasource:
    url: jdbc:postgresql://postgres:5432/app?useUnicode=true&characterEncoding=UTF-8
    username: app
    password: app123
    driver-class-name: org.postgresql.Driver
  
  jpa:
    hibernate:
      ddl-auto: none
    show-sql: ${SPRING_JPA_SHOW_SQL:false}
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
  
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
  
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: ${SPRING_SECURITY_OAUTH2_RESOURCESERVER_JWT_JWK_SET_URI:http://keycloak:8080/auth/realms/iorecycling/protocol/openid-connect/certs}

# Configuration MinIO
app:
  minio:
    endpoint: ${MINIO_ENDPOINT:http://minio:9000}
    public-endpoint: ${MINIO_PUBLIC_ENDPOINT:http://localhost:9000}
    access-key: ${MINIO_ACCESS_KEY:minio}
    secret-key: ${MINIO_SECRET_KEY:minio123}
    bucket: ${MINIO_BUCKET:docs}
    region: us-east-1

# Configuration SpringDoc OpenAPI
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /api/swagger-ui.html
    operationsSorter: method
    tagsSorter: alpha

server:
  port: 8080
  servlet:
    context-path: /
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/xml,text/plain

management:
  server:
    port: 8080
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
    prometheus:
      enabled: true
  metrics:
    tags:
      application: ${spring.application.name}
    distribution:
      percentiles-histogram:
        http.server.requests: true
      percentiles:
        http.server.requests: 0.5, 0.95, 0.99
    enable:
      all: true
      jvm: true
      process: true
      system: true
      http: true
      jdbc: true
  info:
    env:
      enabled: true

# Configuration OpenTelemetry - Traces uniquement (logs via Loki, m√©triques via Prometheus)
opentelemetry:
  resource:
    attributes:
      service.name: ${spring.application.name}
      service.version: ${spring.application.version:0.0.1-SNAPSHOT}
  traces:
    exporter:
      otlp:
        endpoint: ${OTEL_EXPORTER_OTLP_ENDPOINT:http://tempo:4318}
        protocol: http/protobuf
  instrumentation:
    spring-webmvc:
      enabled: true
    spring-webflux:
      enabled: false
    jdbc:
      enabled: true
    jpa:
      enabled: true

logging:
  config: classpath:logback-spring.xml
  level:
    ma.iorecycling: ${LOG_LEVEL:INFO}
    org.springframework.security: ${SECURITY_LOG_LEVEL:DEBUG}
    org.hibernate.SQL: ${SQL_LOG_LEVEL:WARN}
    io.opentelemetry: WARN
    io.grpc: WARN

# Configuration Keycloak
keycloak:
  auth-server-url: ${KEYCLOAK_AUTH_SERVER_URL:http://localhost:8081/auth}
  realm: ${KEYCLOAK_REALM:master}
  resource: ${KEYCLOAK_CLIENT_ID:iorecycling-backend}
  credentials:
    secret: ${KEYCLOAK_CLIENT_SECRET:}
  admin:
    server-url: ${KEYCLOAK_SERVER_URL:http://keycloak:8080/auth}
    realm: ${KEYCLOAK_ADMIN_REALM:iorecycling}
    client-id: ${KEYCLOAK_ADMIN_CLIENT_ID:admin-cli}
    username: ${KEYCLOAK_ADMIN_USERNAME:admin}
    password: ${KEYCLOAK_ADMIN_PASSWORD:admin}
    client-role: ${KEYCLOAK_CLIENT_ROLE:CLIENT}

# Configuration MinIO
minio:
  endpoint: ${MINIO_ENDPOINT:http://localhost:9000}
  access-key: ${MINIO_ACCESS_KEY:minio}
  secret-key: ${MINIO_SECRET_KEY:minio123}
  bucket-name: ${MINIO_BUCKET_NAME:iorecycling}

# Configuration CORS
cors:
  allowed-origins:
    - http://localhost:88
    - http://localhost:3000
    - http://localhost:4200
  allowed-methods:
    - GET
    - POST
    - PUT
    - DELETE
    - OPTIONS
  allowed-headers:
    - "*"
  allow-credentials: true
