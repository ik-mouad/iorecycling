groups:
  - name: iorecycling-alerts
    rules:
      - alert: InstanceDown
        expr: up{job="iorecycling-backend"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Instance IORecycling backend down"
          description: "Le backend IORecycling ne répond plus à Prometheus depuis 1 minute."

      - alert: HighLatencyP95
        expr: histogram_quantile(0.95, sum(rate(http_server_requests_seconds_bucket[5m])) by (le)) > 0.5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Latence HTTP p95 élevée (>500ms)"
          description: "La latence p95 des requêtes HTTP dépasse 500ms depuis plus de 5 minutes."

      - alert: HighErrorRate5xx
        expr: |
          sum(rate(http_server_requests_seconds_count{status=~"5.."}[5m]))
          /
          sum(rate(http_server_requests_seconds_count[5m]))
          > 0.05
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Taux d'erreur 5xx élevé (>5%)"
          description: "Le taux de réponses 5xx dépasse 5% des requêtes HTTP depuis plus de 5 minutes."

      - alert: HighJVMMemoryUsage
        expr: |
          (sum(jvm_memory_used_bytes{area="heap"}) by (instance))
          /
          (sum(jvm_memory_max_bytes{area="heap"}) by (instance))
          > 0.8
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Utilisation mémoire JVM élevée (>80%)"
          description: "La JVM consomme plus de 80% de son heap depuis plus de 5 minutes."


