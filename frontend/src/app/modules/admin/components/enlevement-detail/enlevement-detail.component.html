<div class="enlevement-detail-container" *ngIf="enlevement">
  <!-- Header Premium -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <button mat-icon-button (click)="backToList()" class="back-button">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <div class="header-title-group">
          <h1 class="page-title">Enl√®vement {{ enlevement.numeroEnlevement }}</h1>
          <p class="page-description">D√©tails complets de l'enl√®vement et documents associ√©s</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Informations g√©n√©rales -->
  <div class="info-card">
    <h2 class="card-title">üìã Informations g√©n√©rales</h2>
    <div class="info-grid">
      <div class="info-item">
        <label class="info-label">Num√©ro</label>
        <div class="info-value">
          <span class="badge badge-ice">{{ enlevement.numeroEnlevement }}</span>
        </div>
      </div>
      <div class="info-item">
        <label class="info-label">Date</label>
        <div class="info-value">{{ enlevement.dateEnlevement | date:'dd/MM/yyyy' }}</div>
      </div>
      <div class="info-item">
        <label class="info-label">Soci√©t√©</label>
        <div class="info-value">{{ enlevement.societeNom }}</div>
      </div>
      <div class="info-item">
        <label class="info-label">Site</label>
        <div class="info-value">üìç {{ enlevement.siteNom }}</div>
      </div>
      <div class="info-item full-width" *ngIf="enlevement.observation">
        <label class="info-label">Observation</label>
        <div class="info-value">{{ enlevement.observation }}</div>
      </div>
    </div>
  </div>

  <!-- D√©tails des d√©chets -->
  <div class="items-card">
    <h2 class="card-title">üì¶ D√©tails des d√©chets</h2>
    <div class="table-wrapper">
      <table mat-table [dataSource]="enlevement.items || []" class="premium-table">
        <ng-container matColumnDef="typeDechet">
          <th mat-header-cell *matHeaderCellDef class="table-header">Type</th>
          <td mat-cell *matCellDef="let item" class="table-cell">
            <span class="badge" [ngClass]="'badge-type-' + item.typeDechet.toLowerCase()">
              {{ getTypeDechetLabel(item.typeDechet) }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="sousType">
          <th mat-header-cell *matHeaderCellDef class="table-header">Sous-type</th>
          <td mat-cell *matCellDef="let item" class="table-cell">{{ item.sousType || '-' }}</td>
        </ng-container>

        <ng-container matColumnDef="quantiteKg">
          <th mat-header-cell *matHeaderCellDef class="table-header">Quantit√©</th>
          <td mat-cell *matCellDef="let item" class="table-cell">{{ item.quantiteKg | number:'1.3-3' }} {{ item.uniteMesure || 'kg' }}</td>
        </ng-container>

        <ng-container matColumnDef="etat">
          <th mat-header-cell *matHeaderCellDef class="table-header">√âtat</th>
          <td mat-cell *matCellDef="let item" class="table-cell">{{ item.etat || '-' }}</td>
        </ng-container>

        <ng-container matColumnDef="prixUnitaireMad">
          <th mat-header-cell *matHeaderCellDef class="table-header">Prix unitaire</th>
          <td mat-cell *matCellDef="let item" class="table-cell">{{ item.prixUnitaireMad | number:'1.2-2' }} MAD / {{ item.uniteMesure || 'kg' }}</td>
        </ng-container>

        <ng-container matColumnDef="montant">
          <th mat-header-cell *matHeaderCellDef class="table-header">Montant</th>
          <td mat-cell *matCellDef="let item" class="table-cell">
            <strong class="montant-value">{{ (item.quantiteKg * item.prixUnitaireMad) | number:'1.2-2' }} MAD</strong>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns" class="table-header-row"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns" class="table-row"></tr>
      </table>
    </div>
  </div>

  <!-- Totaux et statistiques -->
  <div class="totals-card">
    <h2 class="card-title">üí∞ Totaux et statistiques</h2>
    <div class="totals-grid">
      <div class="total-item">
        <label class="total-label">Poids total</label>
        <div class="total-value">{{ enlevement.poidsTotal | number:'1.1-1' }} kg</div>
      </div>
      <div class="total-item total-success">
        <label class="total-label">Budget recyclage</label>
        <div class="total-value">+{{ enlevement.budgetRecyclage | number:'1.2-2' }} MAD</div>
      </div>
      <div class="total-item total-danger">
        <label class="total-label">Budget traitement</label>
        <div class="total-value">-{{ enlevement.budgetTraitement | number:'1.2-2' }} MAD</div>
      </div>
      <div class="total-item" [ngClass]="'total-' + getBilanClass(enlevement.bilanNet)">
        <label class="total-label">Bilan net</label>
        <div class="total-value">
          {{ enlevement.bilanNet > 0 ? '+' : '' }}{{ enlevement.bilanNet | number:'1.2-2' }} MAD
        </div>
      </div>
      <div class="total-item">
        <label class="total-label">Taux de recyclage</label>
        <div class="total-value">
          <span class="badge" [ngClass]="'badge-taux-' + getTauxClass(enlevement.tauxRecyclage)">
            {{ enlevement.tauxRecyclage | number:'1.0-0' }}%
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Documents associ√©s -->
  <div class="documents-card">
    <div class="documents-header">
      <h2 class="card-title">üìÑ Documents Associ√©s</h2>
      <button mat-raised-button color="primary" class="upload-button" (click)="uploadDocument()">
        <mat-icon>cloud_upload</mat-icon>
        <span>Uploader un document</span>
      </button>
    </div>
    <div class="documents-content">
      <div *ngIf="loadingDocuments" class="loading-documents">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
      <div *ngIf="!loadingDocuments && documents.length > 0" class="documents-list">
        <div *ngFor="let doc of documents" class="document-item">
          <div class="document-info">
            <mat-icon class="document-icon">description</mat-icon>
            <div class="document-details">
              <strong class="document-name">{{ doc.fileName }}</strong>
              <small class="document-type">{{ doc.typeDocument }}</small>
            </div>
          </div>
          <div class="document-actions">
            <button mat-icon-button (click)="downloadDocument(doc)" matTooltip="T√©l√©charger" class="action-button">
              <mat-icon>download</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="deleteDocument(doc)" matTooltip="Supprimer" class="action-button">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </div>
      <div *ngIf="!loadingDocuments && documents.length === 0" class="empty-state">
        <mat-icon class="empty-icon">folder_off</mat-icon>
        <h3 class="empty-title">Aucun document associ√©</h3>
        <p class="empty-description">Uploader le premier document pour cet enl√®vement</p>
        <button mat-raised-button color="primary" class="primary-button" (click)="uploadDocument()">
          <mat-icon>cloud_upload</mat-icon>
          <span>Uploader le premier document</span>
        </button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="loading" class="loading-overlay">
  <mat-spinner diameter="50"></mat-spinner>
</div>
