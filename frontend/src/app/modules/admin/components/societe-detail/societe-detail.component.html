<div class="societe-detail-container" *ngIf="societe">
  <!-- Header Premium -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <button mat-icon-button (click)="backToList()" class="back-button">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <div class="header-title-group">
          <h1 class="page-title">{{ societe.raisonSociale }}</h1>
          <p class="page-description">{{ 'societe.details' | translate }}</p>
        </div>
      </div>
      <div class="header-actions">
        <button mat-raised-button color="primary" class="primary-button" (click)="editSociete()">
          <mat-icon>edit</mat-icon>
          <span>{{ 'common.edit' | translate }}</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Tabs Premium -->
  <mat-tab-group class="premium-tabs">
    <!-- ONGLET 1 : Informations -->
    <mat-tab [label]="'societe.information' | translate">
      <div class="tab-content">
        <div class="info-card">
          <div class="info-grid">
            <div class="info-item">
              <label class="info-label">{{ 'societe.raisonSociale' | translate }}</label>
              <div class="info-value">{{ societe.raisonSociale }}</div>
            </div>
            <div class="info-item">
              <label class="info-label">{{ 'societe.ice' | translate }}</label>
              <div class="info-value">
                <span class="badge badge-ice">{{ societe.ice }}</span>
              </div>
            </div>
            <div class="info-item">
              <label class="info-label">{{ 'societe.email' | translate }}</label>
              <div class="info-value">{{ societe.email }}</div>
            </div>
            <div class="info-item">
              <label class="info-label">{{ 'societe.telephone' | translate }}</label>
              <div class="info-value">{{ societe.telephone || '-' }}</div>
            </div>
            <div class="info-item full-width" *ngIf="societe.commentaire">
              <label class="info-label">{{ 'societe.commentaire' | translate }}</label>
              <div class="info-value">{{ societe.commentaire }}</div>
            </div>
            <div class="info-item">
              <label class="info-label">{{ 'societe.nbSites' | translate }}</label>
              <div class="info-value">
                <span class="badge badge-sites">{{ societe.nbSites || 0 }}</span>
              </div>
            </div>
            <div class="info-item">
              <label class="info-label">{{ 'societe.nbUsers' | translate }}</label>
              <div class="info-value">
                <span class="badge badge-users">{{ societe.nbUtilisateurs || 0 }}</span>
              </div>
            </div>
            <div class="info-item">
              <label class="info-label">{{ 'societe.nbPickups' | translate }}</label>
              <div class="info-value">
                <span class="badge badge-enlevements">{{ societe.nbEnlevements || 0 }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </mat-tab>

    <!-- ONGLET 2 : Sites -->
    <mat-tab [label]="getSitesTabLabel()">
      <div class="tab-content">
        <div class="tab-header">
          <h3 class="tab-title">{{ 'site.collectionSites' | translate }}</h3>
          <button mat-raised-button color="primary" class="primary-button" (click)="addSite()">
            <mat-icon>add</mat-icon>
            <span>{{ 'site.addSite' | translate }}</span>
          </button>
        </div>

        <div class="table-card" *ngIf="sites.length > 0">
          <div class="table-wrapper">
            <table mat-table [dataSource]="sites" class="premium-table">
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'site.siteName' | translate }}</th>
                <td mat-cell *matCellDef="let site" class="table-cell">
                  <strong>{{ site.name }}</strong>
                </td>
              </ng-container>

              <ng-container matColumnDef="adresse">
                <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'site.adresse' | translate }}</th>
                <td mat-cell *matCellDef="let site" class="table-cell">{{ site.adresse || '-' }}</td>
              </ng-container>

              <ng-container matColumnDef="nbEnlevements">
                <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'site.pickups' | translate }}</th>
                <td mat-cell *matCellDef="let site" class="table-cell">
                  <span class="badge badge-enlevements">{{ site.nbEnlevements || 0 }}</span>
                </td>
              </ng-container>

              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef class="table-header table-header-actions">{{ 'common.actions' | translate }}</th>
                <td mat-cell *matCellDef="let site" class="table-cell table-cell-actions">
                  <button mat-icon-button color="accent" (click)="editSite(site)" class="action-button">
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button mat-icon-button color="warn" (click)="deleteSite(site)" class="action-button">
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumnsSites" class="table-header-row"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsSites" class="table-row"></tr>
            </table>
          </div>
        </div>

        <div class="empty-state" *ngIf="sites.length === 0">
          <mat-icon class="empty-icon">location_off</mat-icon>
          <h3 class="empty-title">{{ 'site.noSites' | translate }}</h3>
          <p class="empty-description">{{ 'site.noSitesDesc' | translate }}</p>
          <button mat-raised-button color="primary" class="primary-button" (click)="addSite()">
            {{ 'site.addFirstSite' | translate }}
          </button>
        </div>
      </div>
    </mat-tab>

    <!-- ONGLET 3 : Utilisateurs -->
    <mat-tab [label]="getUsersTabLabel()">
      <div class="tab-content">
        <div class="tab-header">
          <h3 class="tab-title">{{ 'user.title' | translate }}</h3>
          <button mat-raised-button color="primary" class="primary-button" (click)="addUser()">
            <mat-icon>person_add</mat-icon>
            <span>{{ 'user.addUser' | translate }}</span>
          </button>
        </div>

        <div class="table-card" *ngIf="utilisateurs.length > 0">
          <div class="table-wrapper">
            <table mat-table [dataSource]="utilisateurs" class="premium-table">
              <ng-container matColumnDef="nom">
                <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'user.lastName' | translate }}</th>
                <td mat-cell *matCellDef="let user" class="table-cell">{{ user.nom }}</td>
              </ng-container>

              <ng-container matColumnDef="prenom">
                <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'user.firstName' | translate }}</th>
                <td mat-cell *matCellDef="let user" class="table-cell">{{ user.prenom }}</td>
              </ng-container>

              <ng-container matColumnDef="posteOccupe">
                <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'user.position' | translate }}</th>
                <td mat-cell *matCellDef="let user" class="table-cell">{{ user.posteOccupe || '-' }}</td>
              </ng-container>

              <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'societe.email' | translate }}</th>
                <td mat-cell *matCellDef="let user" class="table-cell">{{ user.email }}</td>
              </ng-container>

              <ng-container matColumnDef="active">
                <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'user.status' | translate }}</th>
                <td mat-cell *matCellDef="let user" class="table-cell">
                  <span class="badge" [ngClass]="user.active ? 'badge-success' : 'badge-danger'">
                    {{ user.active ? ('common.active' | translate) : ('common.inactive' | translate) }}
                  </span>
                </td>
              </ng-container>

              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef class="table-header table-header-actions">{{ 'common.actions' | translate }}</th>
                <td mat-cell *matCellDef="let user" class="table-cell table-cell-actions">
                  <button mat-icon-button color="accent" (click)="editUser(user)" [matTooltip]="'common.edit' | translate" class="action-button">
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button mat-icon-button [color]="user.active ? 'warn' : 'primary'" 
                          (click)="toggleUserActive(user)"
                          [matTooltip]="user.active ? ('user.deactivate' | translate) : ('user.activate' | translate)"
                          class="action-button">
                    <mat-icon>{{ user.active ? 'block' : 'check_circle' }}</mat-icon>
                  </button>
                  <button mat-icon-button color="warn" (click)="deleteUser(user)" [matTooltip]="'common.delete' | translate" class="action-button">
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumnsUsers" class="table-header-row"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsUsers" class="table-row"></tr>
            </table>
          </div>
        </div>

        <div class="empty-state" *ngIf="utilisateurs.length === 0">
          <mat-icon class="empty-icon">people_off</mat-icon>
          <h3 class="empty-title">{{ 'user.noUsers' | translate }}</h3>
          <p class="empty-description">{{ 'user.noUsersDesc' | translate }}</p>
          <button mat-raised-button color="primary" class="primary-button" (click)="addUser()">
            {{ 'user.addFirstUser' | translate }}
          </button>
        </div>
      </div>
    </mat-tab>

    <!-- ONGLET 4 : Enl√®vements -->
    <mat-tab [label]="getEnlevementsTabLabel()">
      <div class="tab-content">
        <div class="tab-header">
          <h3 class="tab-title">{{ 'societe.pickupHistory' | translate }}</h3>
          <button mat-raised-button color="primary" class="primary-button" (click)="createEnlevement()">
            <mat-icon>add</mat-icon>
            <span>{{ 'societe.newPickup' | translate }}</span>
          </button>
        </div>

        <div class="table-card" *ngIf="enlevements.length > 0">
          <div class="table-wrapper">
            <table mat-table [dataSource]="enlevements" class="premium-table">
              <ng-container matColumnDef="numeroEnlevement">
                <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'enlevement.numero' | translate }}</th>
                <td mat-cell *matCellDef="let enlevement" class="table-cell">
                  <span class="badge badge-ice">{{ enlevement.numeroEnlevement }}</span>
                </td>
              </ng-container>

              <ng-container matColumnDef="dateEnlevement">
                <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'enlevement.date' | translate }}</th>
                <td mat-cell *matCellDef="let enlevement" class="table-cell">
                  {{ enlevement.dateEnlevement | date:'dd/MM/yyyy' }}
                </td>
              </ng-container>

              <ng-container matColumnDef="siteNom">
                <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'enlevement.site' | translate }}</th>
                <td mat-cell *matCellDef="let enlevement" class="table-cell">
                  <div class="site-text">üìç {{ enlevement.siteNom }}</div>
                </td>
              </ng-container>

              <ng-container matColumnDef="poidsTotal">
                <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'societe.totalWeight' | translate }}</th>
                <td mat-cell *matCellDef="let enlevement" class="table-cell">
                  <span class="badge badge-weight">{{ enlevement.poidsTotal | number:'1.1-1' }} kg</span>
                </td>
              </ng-container>

              <ng-container matColumnDef="bilanNet">
                <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'societe.netBalance' | translate }}</th>
                <td mat-cell *matCellDef="let enlevement" class="table-cell">
                  <span class="bilan" [ngClass]="enlevement.bilanNet >= 0 ? 'bilan-positif' : 'bilan-negatif'">
                    <ng-container *ngIf="enlevement.bilanNet > 0">+</ng-container>{{ enlevement.bilanNet | number:'1.2-2' }} MAD
                  </span>
                </td>
              </ng-container>

              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef class="table-header table-header-actions">{{ 'common.actions' | translate }}</th>
                <td mat-cell *matCellDef="let enlevement" class="table-cell table-cell-actions">
                  <button mat-icon-button color="primary" (click)="viewEnlevement(enlevement)" [matTooltip]="'common.viewDetails' | translate" class="action-button">
                    <mat-icon>visibility</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumnsEnlevements" class="table-header-row"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumnsEnlevements" class="table-row"></tr>
            </table>
          </div>
        </div>

        <div class="empty-state" *ngIf="enlevements.length === 0">
          <mat-icon class="empty-icon">inventory_2</mat-icon>
          <h3 class="empty-title">{{ 'societe.noPickups' | translate }}</h3>
          <p class="empty-description">{{ 'societe.noPickupsDesc' | translate }}</p>
          <button mat-raised-button color="primary" class="primary-button" (click)="createEnlevement()">
            {{ 'societe.createFirstPickup' | translate }}
          </button>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
