<div class="societe-detail-container" *ngIf="societe">
  <div class="header">
    <div>
      <button mat-icon-button (click)="backToList()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1>{{ societe.raisonSociale }}</h1>
    </div>
    <button mat-raised-button color="primary" (click)="editSociete()">
      <mat-icon>edit</mat-icon>
      Modifier
    </button>
  </div>

  <mat-tab-group>
    <!-- ONGLET 1 : Informations -->
    <mat-tab label="Informations">
      <mat-card class="info-card">
        <mat-card-content>
          <div class="info-grid">
            <div class="info-item">
              <label>Raison Sociale</label>
              <div>{{ societe.raisonSociale }}</div>
            </div>
            <div class="info-item">
              <label>ICE</label>
              <div><code>{{ societe.ice }}</code></div>
            </div>
            <div class="info-item">
              <label>Email</label>
              <div>{{ societe.email }}</div>
            </div>
            <div class="info-item">
              <label>T√©l√©phone</label>
              <div>{{ societe.telephone || '-' }}</div>
            </div>
            <div class="info-item full-width" *ngIf="societe.commentaire">
              <label>Commentaire</label>
              <div>{{ societe.commentaire }}</div>
            </div>
            <div class="info-item">
              <label>Nombre de sites</label>
              <div><strong>{{ societe.nbSites || 0 }}</strong></div>
            </div>
            <div class="info-item">
              <label>Nombre d'utilisateurs</label>
              <div><strong>{{ societe.nbUtilisateurs || 0 }}</strong></div>
            </div>
            <div class="info-item">
              <label>Nombre d'enl√®vements</label>
              <div><strong>{{ societe.nbEnlevements || 0 }}</strong></div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </mat-tab>

    <!-- ONGLET 2 : Sites -->
    <mat-tab label="Sites ({{ sites.length }})">
      <div class="tab-content">
        <div class="tab-header">
          <h3>Sites de collecte</h3>
          <button mat-raised-button color="primary" (click)="addSite()">
            <mat-icon>add</mat-icon>
            Ajouter un site
          </button>
        </div>

        <table mat-table [dataSource]="sites" class="mat-elevation-z2" *ngIf="sites.length > 0">
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Nom du site</th>
            <td mat-cell *matCellDef="let site"><strong>{{ site.name }}</strong></td>
          </ng-container>

          <ng-container matColumnDef="adresse">
            <th mat-header-cell *matHeaderCellDef>Adresse</th>
            <td mat-cell *matCellDef="let site">{{ site.adresse || '-' }}</td>
          </ng-container>

          <ng-container matColumnDef="nbEnlevements">
            <th mat-header-cell *matHeaderCellDef>Enl√®vements</th>
            <td mat-cell *matCellDef="let site">
              <span class="badge">{{ site.nbEnlevements || 0 }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let site">
              <button mat-icon-button color="accent" (click)="editSite(site)">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="deleteSite(site)">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsSites"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsSites;"></tr>
        </table>

        <div class="empty-state" *ngIf="sites.length === 0">
          <mat-icon>location_off</mat-icon>
          <p>Aucun site pour cette soci√©t√©</p>
          <button mat-raised-button color="primary" (click)="addSite()">
            Ajouter le premier site
          </button>
        </div>
      </div>
    </mat-tab>

    <!-- ONGLET 3 : Utilisateurs -->
    <mat-tab label="Utilisateurs ({{ utilisateurs.length }})">
      <div class="tab-content">
        <div class="tab-header">
          <h3>Utilisateurs</h3>
          <button mat-raised-button color="primary" (click)="addUser()">
            <mat-icon>person_add</mat-icon>
            Ajouter un utilisateur
          </button>
        </div>

        <table mat-table [dataSource]="utilisateurs" class="mat-elevation-z2" *ngIf="utilisateurs.length > 0">
          <ng-container matColumnDef="nom">
            <th mat-header-cell *matHeaderCellDef>Nom</th>
            <td mat-cell *matCellDef="let user">{{ user.nom }}</td>
          </ng-container>

          <ng-container matColumnDef="prenom">
            <th mat-header-cell *matHeaderCellDef>Pr√©nom</th>
            <td mat-cell *matCellDef="let user">{{ user.prenom }}</td>
          </ng-container>

          <ng-container matColumnDef="posteOccupe">
            <th mat-header-cell *matHeaderCellDef>Poste</th>
            <td mat-cell *matCellDef="let user">{{ user.posteOccupe || '-' }}</td>
          </ng-container>

          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef>Email</th>
            <td mat-cell *matCellDef="let user">{{ user.email }}</td>
          </ng-container>

          <ng-container matColumnDef="active">
            <th mat-header-cell *matHeaderCellDef>Statut</th>
            <td mat-cell *matCellDef="let user">
              <span [class]="user.active ? 'badge badge-success' : 'badge badge-danger'">
                {{ user.active ? 'Actif' : 'Inactif' }}
              </span>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let user">
              <button mat-icon-button color="accent" (click)="editUser(user)" matTooltip="Modifier">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button [color]="user.active ? 'warn' : 'primary'" 
                      (click)="toggleUserActive(user)"
                      [matTooltip]="user.active ? 'D√©sactiver' : 'Activer'">
                <mat-icon>{{ user.active ? 'block' : 'check_circle' }}</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="deleteUser(user)" matTooltip="Supprimer">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsUsers"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsUsers;"></tr>
        </table>

        <div class="empty-state" *ngIf="utilisateurs.length === 0">
          <mat-icon>people_off</mat-icon>
          <p>Aucun utilisateur pour cette soci√©t√©</p>
          <button mat-raised-button color="primary" (click)="addUser()">
            Ajouter le premier utilisateur
          </button>
        </div>
      </div>
    </mat-tab>

    <!-- ONGLET 4 : Enl√®vements -->
    <mat-tab label="Enl√®vements ({{ enlevements.length }})">
      <div class="tab-content">
        <div class="tab-header">
          <h3>Historique des enl√®vements</h3>
          <button mat-raised-button color="primary" (click)="createEnlevement()">
            <mat-icon>add</mat-icon>
            Nouvel enl√®vement
          </button>
        </div>

        <table mat-table [dataSource]="enlevements" class="mat-elevation-z2" *ngIf="enlevements.length > 0">
          <ng-container matColumnDef="numeroEnlevement">
            <th mat-header-cell *matHeaderCellDef>Num√©ro</th>
            <td mat-cell *matCellDef="let enlevement">
              <code class="numero">{{ enlevement.numeroEnlevement }}</code>
            </td>
          </ng-container>

          <ng-container matColumnDef="dateEnlevement">
            <th mat-header-cell *matHeaderCellDef>Date</th>
            <td mat-cell *matCellDef="let enlevement">
              {{ enlevement.dateEnlevement | date:'dd/MM/yyyy' }}
            </td>
          </ng-container>

          <ng-container matColumnDef="siteNom">
            <th mat-header-cell *matHeaderCellDef>Site</th>
            <td mat-cell *matCellDef="let enlevement">
              <small>üìç {{ enlevement.siteNom }}</small>
            </td>
          </ng-container>

          <ng-container matColumnDef="poidsTotal">
            <th mat-header-cell *matHeaderCellDef>Poids total</th>
            <td mat-cell *matCellDef="let enlevement">
              <span class="badge">{{ enlevement.poidsTotal | number:'1.1-1' }} kg</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="bilanNet">
            <th mat-header-cell *matHeaderCellDef>Bilan net</th>
            <td mat-cell *matCellDef="let enlevement">
              <span class="bilan" [ngClass]="enlevement.bilanNet >= 0 ? 'bilan-positif' : 'bilan-negatif'">
                {{ enlevement.bilanNet > 0 ? '+' : '' }}{{ enlevement.bilanNet | number:'1.2-2' }} MAD
              </span>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let enlevement">
              <button mat-icon-button color="primary" (click)="viewEnlevement(enlevement)" matTooltip="Voir d√©tails">
                <mat-icon>visibility</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsEnlevements"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsEnlevements;"></tr>
        </table>

        <div class="empty-state" *ngIf="enlevements.length === 0">
          <mat-icon>inventory_2</mat-icon>
          <p>Aucun enl√®vement pour cette soci√©t√©</p>
          <button mat-raised-button color="primary" (click)="createEnlevement()">
            Cr√©er le premier enl√®vement
          </button>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>

