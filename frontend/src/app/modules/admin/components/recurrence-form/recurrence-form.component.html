<h2 mat-dialog-title class="dialog-title">
  <mat-icon>schedule</mat-icon>
  <span>{{ 'recurrence.new' | translate }}</span>
</h2>

<form [formGroup]="recurrenceForm" (ngSubmit)="submit()" class="recurrence-form">
  <mat-dialog-content class="dialog-content">
    <div class="form-fields">
      <mat-form-field appearance="outline" class="form-field">
        <mat-label>{{ 'recurrence.societe' | translate }}<span class="required-asterisk">*</span></mat-label>
        <mat-icon matPrefix>business</mat-icon>
        <mat-select formControlName="societeId">
          <mat-option *ngFor="let societe of societes" [value]="societe.id">
            {{ societe.raisonSociale }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="recurrenceForm.get('societeId')?.hasError('required')">
          {{ 'recurrence.societeRequired' | translate }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>{{ 'recurrence.site' | translate }}<span class="required-asterisk">*</span></mat-label>
        <mat-icon matPrefix>location_on</mat-icon>
        <mat-select formControlName="siteId" [disabled]="!recurrenceForm.value.societeId || loadingSites">
          <mat-option *ngIf="loadingSites" disabled>{{ 'recurrence.loadingSites' | translate }}</mat-option>
          <mat-option *ngFor="let site of sites" [value]="site.id">
            {{ site.name }}
          </mat-option>
        </mat-select>
        <mat-hint *ngIf="loadingSites">{{ 'recurrence.loadingSites' | translate }}</mat-hint>
        <mat-error *ngIf="recurrenceForm.get('siteId')?.hasError('required')">
          {{ 'recurrence.siteRequired' | translate }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>{{ 'recurrence.typeRecurrence' | translate }}<span class="required-asterisk">*</span></mat-label>
        <mat-icon matPrefix>repeat</mat-icon>
        <mat-select formControlName="typeRecurrence">
          <mat-option *ngFor="let type of typeRecurrenceOptions" [value]="type.value">
            {{ type.label }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="recurrenceForm.get('typeRecurrence')?.hasError('required')">
          {{ 'recurrence.typeRecurrenceRequired' | translate }}
        </mat-error>
      </mat-form-field>

      <!-- Options selon le type de rÃ©currence -->
      <mat-form-field appearance="outline" class="form-field" *ngIf="getTypeRecurrence() === 'HEBDOMADAIRE'">
        <mat-label>{{ 'recurrence.jourSemaine' | translate }}<span class="required-asterisk">*</span></mat-label>
        <mat-icon matPrefix>calendar_today</mat-icon>
        <mat-select formControlName="jourSemaine">
          <mat-option *ngFor="let jour of jourSemaineOptions" [value]="jour.value">
            {{ jour.label }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="recurrenceForm.get('jourSemaine')?.hasError('required')">
          {{ 'recurrence.jourSemaineRequired' | translate }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field" *ngIf="getTypeRecurrence() === 'BIMENSUELLE'">
        <mat-label>{{ 'recurrence.joursSemaine' | translate }}<span class="required-asterisk">*</span></mat-label>
        <mat-icon matPrefix>event</mat-icon>
        <input matInput formControlName="joursSemaneBimensuel" placeholder="Ex: LUNDI,JEUDI">
        <mat-hint>{{ 'recurrence.joursSemaineHint' | translate }}</mat-hint>
        <mat-error *ngIf="recurrenceForm.get('joursSemaneBimensuel')?.hasError('required')">
          {{ 'recurrence.joursSemaineRequired' | translate }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field" *ngIf="getTypeRecurrence() === 'MENSUELLE'">
        <mat-label>{{ 'recurrence.jourMois' | translate }}<span class="required-asterisk">*</span></mat-label>
        <mat-icon matPrefix>calendar_view_day</mat-icon>
        <input matInput type="number" formControlName="jourMois" min="1" max="31">
        <mat-error *ngIf="recurrenceForm.get('jourMois')?.hasError('required')">
          {{ 'recurrence.jourMoisRequired' | translate }}
        </mat-error>
        <mat-error *ngIf="recurrenceForm.get('jourMois')?.hasError('min') || recurrenceForm.get('jourMois')?.hasError('max')">
          {{ 'recurrence.jourMoisInvalid' | translate }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field">
        <mat-label>{{ 'recurrence.heurePrevue' | translate }}</mat-label>
        <mat-icon matPrefix>schedule</mat-icon>
        <input matInput formControlName="heurePrevue" placeholder="Ex: 09:00">
        <mat-hint>{{ 'recurrence.heurePrevueHint' | translate }}</mat-hint>
      </mat-form-field>

      <div class="dates-section">
        <mat-form-field appearance="outline" class="form-field">
          <mat-label>{{ 'recurrence.dateDebut' | translate }}<span class="required-asterisk">*</span></mat-label>
          <mat-icon matPrefix>event</mat-icon>
          <input matInput [matDatepicker]="pickerDebut" formControlName="dateDebut">
          <mat-datepicker-toggle matSuffix [for]="pickerDebut"></mat-datepicker-toggle>
          <mat-datepicker #pickerDebut></mat-datepicker>
          <mat-error *ngIf="recurrenceForm.get('dateDebut')?.hasError('required')">
            {{ 'recurrence.dateDebutRequired' | translate }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field">
          <mat-label>{{ 'recurrence.dateFin' | translate }}</mat-label>
          <mat-icon matPrefix>event</mat-icon>
          <input matInput [matDatepicker]="pickerFin" formControlName="dateFin">
          <mat-datepicker-toggle matSuffix [for]="pickerFin"></mat-datepicker-toggle>
          <mat-datepicker #pickerFin></mat-datepicker>
          <mat-hint>{{ 'recurrence.dateFinHint' | translate }}</mat-hint>
        </mat-form-field>
      </div>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end" class="dialog-actions">
    <button mat-button type="button" (click)="cancel()" [disabled]="loading" class="cancel-button">
      {{ 'common.cancel' | translate }}
    </button>
    <button mat-raised-button color="primary" type="submit" [disabled]="recurrenceForm.invalid || loading" class="submit-button">
      <mat-icon *ngIf="!loading">save</mat-icon>
      <mat-spinner *ngIf="loading" [diameter]="20" class="button-spinner"></mat-spinner>
      <span *ngIf="!loading">{{ 'recurrence.create' | translate }}</span>
      <span *ngIf="loading">{{ 'common.saving' | translate }}</span>
    </button>
  </mat-dialog-actions>
</form>
