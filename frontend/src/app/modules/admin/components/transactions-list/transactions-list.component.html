<div class="transactions-list">
  <!-- Header Premium -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <h1 class="page-title">{{ 'transaction.title' | translate }}</h1>
        <p class="page-description">{{ 'transaction.manageAll' | translate }}</p>
      </div>
      <div class="header-actions">
        <button mat-raised-button color="primary" class="primary-button" (click)="createTransaction(TypeTransaction.RECETTE)">
          <mat-icon>add</mat-icon>
          <span>{{ 'comptabiliteDashboard.newRecette' | translate }}</span>
        </button>
        <button mat-raised-button color="warn" class="primary-button" (click)="createTransaction(TypeTransaction.DEPENSE)">
          <mat-icon>remove</mat-icon>
          <span>{{ 'comptabiliteDashboard.newDepense' | translate }}</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Filters Card -->
  <mat-card class="filters-card">
    <form [formGroup]="filterForm" (ngSubmit)="onFilterChange()">
      <div class="filters-content">
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>{{ 'transaction.societe' | translate }}</mat-label>
          <mat-select formControlName="societeId" (selectionChange)="onFilterChange()">
            <mat-option [value]="null">{{ 'common.all' | translate }}</mat-option>
            <mat-option *ngFor="let societe of societes" [value]="societe.id">
              {{ societe.raisonSociale }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>{{ 'transaction.type' | translate }}</mat-label>
          <mat-select formControlName="type" (selectionChange)="onFilterChange()">
            <mat-option [value]="null">{{ 'common.all' | translate }}</mat-option>
            <mat-option [value]="'RECETTE'">{{ 'transaction.recettes' | translate }}</mat-option>
            <mat-option [value]="'DEPENSE'">{{ 'transaction.depenses' | translate }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>{{ 'comptabiliteDashboard.dateDebut' | translate }}</mat-label>
          <input matInput [matDatepicker]="picker1" formControlName="dateDebut" (dateChange)="onFilterChange()">
          <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
          <mat-datepicker #picker1></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>{{ 'comptabiliteDashboard.dateFin' | translate }}</mat-label>
          <input matInput [matDatepicker]="picker2" formControlName="dateFin" (dateChange)="onFilterChange()">
          <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
          <mat-datepicker #picker2></mat-datepicker>
        </mat-form-field>
      </div>
    </form>
  </mat-card>

  <!-- Table Card -->
  <mat-card class="table-card">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>{{ 'transaction.loading' | translate }}</p>
    </div>

    <!-- Table -->
    <div *ngIf="!loading" class="table-wrapper">
      <table mat-table [dataSource]="transactions" class="premium-table">
        <!-- Date Column -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'transaction.date' | translate }}</th>
          <td mat-cell *matCellDef="let transaction" class="table-cell">
            <div class="date-cell">
              <span class="date-value">{{ transaction.dateTransaction | date:'dd/MM/yyyy' }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Type Column -->
        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'transaction.type' | translate }}</th>
          <td mat-cell *matCellDef="let transaction" class="table-cell">
            <mat-chip [class.chip-recette]="transaction.type === 'RECETTE'" [class.chip-depense]="transaction.type === 'DEPENSE'">
              <mat-icon>{{ transaction.type === 'RECETTE' ? 'trending_up' : 'trending_down' }}</mat-icon>
              <span>{{ getTypeLabel(transaction.type) }}</span>
            </mat-chip>
          </td>
        </ng-container>

        <!-- Description Column -->
        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'transaction.description' | translate }}</th>
          <td mat-cell *matCellDef="let transaction" class="table-cell">
            <div class="description-cell">
              <span class="description-text">{{ transaction.description }}</span>
              <span *ngIf="transaction.categorie" class="categorie-badge">{{ transaction.categorie }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Enlèvement Column -->
        <ng-container matColumnDef="enlevement">
          <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'transaction.enlevement' | translate }}</th>
          <td mat-cell *matCellDef="let transaction" class="table-cell">
            <div class="enlevement-cell" *ngIf="transaction.enlevementNumero">
              <button mat-button color="primary" class="enlevement-link" (click)="viewEnlevement(transaction.enlevementId!)">
                <mat-icon>local_shipping</mat-icon>
                <span>{{ transaction.enlevementNumero }}</span>
              </button>
            </div>
            <div class="enlevement-cell" *ngIf="!transaction.enlevementNumero">
              <span class="no-enlevement">-</span>
            </div>
          </td>
        </ng-container>

        <!-- Société Column -->
        <ng-container matColumnDef="societe">
          <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'transaction.societe' | translate }}</th>
          <td mat-cell *matCellDef="let transaction" class="table-cell">
            <div class="societe-cell">{{ transaction.societeNom || '-' }}</div>
          </td>
        </ng-container>

        <!-- Montant Column -->
        <ng-container matColumnDef="montant">
          <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'transaction.montant' | translate }}</th>
          <td mat-cell *matCellDef="let transaction" class="table-cell">
            <div class="amount-cell" [class.amount-recette]="transaction.type === 'RECETTE'" [class.amount-depense]="transaction.type === 'DEPENSE'">
              <span class="amount-value">{{ transaction.montant | number:'1.2-2' }}</span>
              <span class="amount-currency">MAD</span>
            </div>
          </td>
        </ng-container>

        <!-- Montant Payé Column -->
        <ng-container matColumnDef="montantPaye">
          <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'transaction.montantPaye' | translate }}</th>
          <td mat-cell *matCellDef="let transaction" class="table-cell">
            <div class="paid-cell">
              <span class="paid-value">{{ transaction.montantPaye || 0 | number:'1.2-2' }}</span>
              <span class="paid-currency">MAD</span>
            </div>
          </td>
        </ng-container>

        <!-- Statut Column -->
        <ng-container matColumnDef="statut">
          <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'transaction.statut' | translate }}</th>
          <td mat-cell *matCellDef="let transaction" class="table-cell">
            <mat-chip [class.chip-paye]="transaction.statut === 'PAYE'" [class.chip-partiel]="transaction.statut === 'PARTIELLEMENT_PAYE'" [class.chip-impaye]="transaction.statut === 'IMPAYE'">
              {{ getStatutLabel(transaction.statut) }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="table-header">{{ 'common.actions' | translate }}</th>
          <td mat-cell *matCellDef="let transaction" class="table-cell actions-cell">
            <button mat-icon-button [matMenuTriggerFor]="menu" class="action-button">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="viewTransaction(transaction.id)">
                <mat-icon>visibility</mat-icon>
                <span>{{ 'common.view' | translate }}</span>
              </button>
              <button mat-menu-item (click)="editTransaction(transaction.id)">
                <mat-icon>edit</mat-icon>
                <span>{{ 'common.edit' | translate }}</span>
              </button>
              <button mat-menu-item (click)="deleteTransaction(transaction.id)" class="delete-action">
                <mat-icon>delete</mat-icon>
                <span>{{ 'common.delete' | translate }}</span>
              </button>
            </mat-menu>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns" class="table-header-row"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row" (click)="viewTransaction(row.id)"></tr>
      </table>

      <!-- Empty State -->
      <div *ngIf="transactions.length === 0" class="empty-state">
        <mat-icon>inbox</mat-icon>
        <h3>{{ 'transaction.noTransactions' | translate }}</h3>
        <p>{{ 'transaction.noTransactionsMatch' | translate }}</p>
      </div>
    </div>

    <!-- Pagination -->
    <mat-paginator
      *ngIf="!loading && transactions.length > 0"
      [length]="totalElements"
      [pageSize]="pageSize"
      [pageIndex]="pageIndex"
      [pageSizeOptions]="[10, 20, 50, 100]"
      (page)="onPageChange($event)"
      class="premium-paginator">
    </mat-paginator>
  </mat-card>
</div>
