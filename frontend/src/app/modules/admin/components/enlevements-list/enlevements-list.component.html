<div class="enlevements-list-container">
  <div class="header">
    <h1>Gestion des Enl√®vements</h1>
    <button mat-raised-button color="primary" (click)="createEnlevement()">
      <mat-icon>add</mat-icon>
      Nouvel Enl√®vement
    </button>
  </div>

  <!-- Filtres -->
  <mat-card class="filters-card">
    <mat-card-content>
      <form [formGroup]="filterForm" class="filters-form">
        <mat-form-field appearance="outline">
          <mat-label>Soci√©t√©</mat-label>
          <mat-select formControlName="societeId">
            <mat-option [value]="">Toutes</mat-option>
            <mat-option *ngFor="let societe of societes" [value]="societe.id">
              {{ societe.raisonSociale }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-raised-button color="primary" (click)="applyFilters()">
          <mat-icon>search</mat-icon>
          Filtrer
        </button>

        <button mat-button (click)="resetFilters()">
          <mat-icon>clear</mat-icon>
          R√©initialiser
        </button>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Tableau -->
  <div class="table-container">
    <table mat-table [dataSource]="enlevements" class="mat-elevation-z2">
      
      <!-- Num√©ro -->
      <ng-container matColumnDef="numeroEnlevement">
        <th mat-header-cell *matHeaderCellDef>Num√©ro</th>
        <td mat-cell *matCellDef="let enlevement">
          <code class="numero">{{ enlevement.numeroEnlevement }}</code>
        </td>
      </ng-container>

      <!-- Date -->
      <ng-container matColumnDef="dateEnlevement">
        <th mat-header-cell *matHeaderCellDef>Date</th>
        <td mat-cell *matCellDef="let enlevement">
          {{ enlevement.dateEnlevement | date:'dd/MM/yyyy' }}
        </td>
      </ng-container>

      <!-- Soci√©t√© -->
      <ng-container matColumnDef="societeNom">
        <th mat-header-cell *matHeaderCellDef>Soci√©t√©</th>
        <td mat-cell *matCellDef="let enlevement">
          {{ enlevement.societeNom }}
        </td>
      </ng-container>

      <!-- Site -->
      <ng-container matColumnDef="siteNom">
        <th mat-header-cell *matHeaderCellDef>Site</th>
        <td mat-cell *matCellDef="let enlevement">
          <small>üìç {{ enlevement.siteNom }}</small>
        </td>
      </ng-container>

      <!-- Poids Total -->
      <ng-container matColumnDef="poidsTotal">
        <th mat-header-cell *matHeaderCellDef>Poids Total</th>
        <td mat-cell *matCellDef="let enlevement">
          <span class="badge">{{ enlevement.poidsTotal | number:'1.1-1' }} kg</span>
        </td>
      </ng-container>

      <!-- Budget Valorisation -->
      <ng-container matColumnDef="budgetValorisation">
        <th mat-header-cell *matHeaderCellDef>Valorisation</th>
        <td mat-cell *matCellDef="let enlevement">
          <span class="badge badge-success">+{{ enlevement.budgetValorisation | number:'1.2-2' }}</span>
        </td>
      </ng-container>

      <!-- Budget Traitement -->
      <ng-container matColumnDef="budgetTraitement">
        <th mat-header-cell *matHeaderCellDef>Traitement</th>
        <td mat-cell *matCellDef="let enlevement">
          <span class="badge badge-danger">-{{ enlevement.budgetTraitement | number:'1.2-2' }}</span>
        </td>
      </ng-container>

      <!-- Bilan Net -->
      <ng-container matColumnDef="bilanNet">
        <th mat-header-cell *matHeaderCellDef>Bilan Net</th>
        <td mat-cell *matCellDef="let enlevement">
          <span class="bilan" [ngClass]="getBilanClass(enlevement.bilanNet)">
            {{ enlevement.bilanNet > 0 ? '+' : '' }}{{ enlevement.bilanNet | number:'1.2-2' }} MAD
          </span>
        </td>
      </ng-container>

      <!-- Taux Valorisation -->
      <ng-container matColumnDef="tauxValorisation">
        <th mat-header-cell *matHeaderCellDef>Taux</th>
        <td mat-cell *matCellDef="let enlevement">
          <mat-chip [ngClass]="getTauxClass(enlevement.tauxValorisation)">
            {{ enlevement.tauxValorisation | number:'1.0-0' }}%
          </mat-chip>
        </td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let enlevement">
          <button mat-icon-button color="primary" (click)="viewEnlevement(enlevement)" matTooltip="Voir d√©tails">
            <mat-icon>visibility</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <mat-paginator 
      [length]="totalElements"
      [pageSize]="pageSize"
      [pageSizeOptions]="[10, 20, 50]"
      (page)="onPageChange($event)"
      showFirstLastButtons>
    </mat-paginator>
  </div>

  <div *ngIf="loading" class="loading-overlay">
    <mat-spinner></mat-spinner>
  </div>
</div>
